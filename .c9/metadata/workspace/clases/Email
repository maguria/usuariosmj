{"changed":true,"filter":false,"title":"Email","tooltip":"/clases/Email","value":"<?php\n\nclass Email {\n    private $cliente, $origen, $destino, $alias, $asunto, $mensaje;\n    \n    function __construct($destino=null,  $asunto=null, $mensaje=null, $origen=null, $alias=null) {\n        $this->cliente = new Google_Client();\n        $this->cliente->setApplicationName('correo');\n        $this->cliente->setClientId('750166320318-drg7l14mcm8qtv254jhb84sbqik6jm29.apps.googleusercontent.com536060712172-mguuql9ce6jv77cu8c4kmheo4irc59sl.apps.googleusercontent.com');\n        $this->cliente->setClientSecret('m-VafCFc8svPQaG_X8Dh_zDk');\n        $this->cliente->setRedirectUri('https://usergest-jmroldan00.c9users.io/mail/oauth/guardar.php');\n        $this->cliente->setScopes('https://www.googleapis.com/auth/gmail.compose');\n        $this->cliente->setAccessToken(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/mail/oauth/token.conf'));\n        $this->from = $from;\n        $this->to = $to;\n        $this->alias = $alias;\n        $this->subject = $subject;\n        $this->message = $message;\n        $this->attachment = $attachment;\n    }\n    \n    function getFrom() {\n        return $this->from;\n    }\n\n    function getTo() {\n        return $this->to;\n    }\n\n    function getSubject() {\n        return $this->subject;\n    }\n\n    function getMessage() {\n        return $this->message;\n    }\n\n    function getAttachment() {\n        return $this->attachment;\n    }\n\n    function setFrom($from) {\n        $this->from = $from;\n    }\n\n    function setTo($to) {\n        $this->to = $to;\n    }\n\n    function setSubject($subject) {\n        $this->subject = $subject;\n    }\n\n    function setMessage($message) {\n        $this->message = $message;\n    }\n\n    function setAttachment($attachment) {\n        $this->attachment = $attachment;\n    }\n\n    function send(){\n        if ($this->cliente->getAccessToken()) {\n            $service = new Google_Service_Gmail($this->cliente);\n            try {\n                $mail = new PHPMailer();\n                $mail->CharSet = \"UTF-8\";\n                $mail->From = $this->from ? null : Constant::_MAILFROM;\n                $mail->FromName = $this->alias ? null : Constant::_MAILALIAS;\n                $mail->AddAddress($this->to);\n                $mail->AddReplyTo($this->from ? null : Constant::_MAILFROM, $this->alias ? null : Constant::_MAILALIAS);\n                $mail->Subject = $this->subject;\n                $mail->Body = $this->message;\n                $mail->preSend();\n                $mime = $mail->getSentMIMEMessage();\n                $mime = rtrim(strtr(base64_encode($mime), '+/', '-_'), '=');\n                $mensaje = new Google_Service_Gmail_Message();\n                $mensaje->setRaw($mime);\n                $service->users_messages->send('me', $this->message);\n                $r = \"Enviado\";\n            } catch (Exception $e) {\n                print($e->getMessage());\n                $r = \"Error envio\";\n            }\n        }else{\n             $r = \"Error gmail\";\n        }\n        return $r;\n    }\n\n}\n\n?>\n","undoManager":{"mark":73,"position":100,"stack":[[{"start":{"row":1,"column":62},"end":{"row":1,"column":63},"action":"remove","lines":["s"],"id":44}],[{"start":{"row":1,"column":61},"end":{"row":1,"column":62},"action":"remove","lines":["s"],"id":45}],[{"start":{"row":1,"column":61},"end":{"row":1,"column":62},"action":"insert","lines":["n"],"id":46}],[{"start":{"row":1,"column":62},"end":{"row":1,"column":63},"action":"insert","lines":["s"],"id":47}],[{"start":{"row":1,"column":63},"end":{"row":1,"column":64},"action":"insert","lines":["a"],"id":48}],[{"start":{"row":1,"column":64},"end":{"row":1,"column":65},"action":"insert","lines":["j"],"id":49}],[{"start":{"row":1,"column":65},"end":{"row":1,"column":66},"action":"insert","lines":["e"],"id":50}],[{"start":{"row":1,"column":83},"end":{"row":1,"column":84},"action":"remove","lines":["]"],"id":51}],[{"start":{"row":1,"column":82},"end":{"row":1,"column":83},"action":"remove","lines":["["],"id":52}],[{"start":{"row":1,"column":81},"end":{"row":1,"column":82},"action":"remove","lines":[" "],"id":53}],[{"start":{"row":1,"column":80},"end":{"row":1,"column":81},"action":"remove","lines":["="],"id":54}],[{"start":{"row":1,"column":79},"end":{"row":1,"column":80},"action":"remove","lines":[" "],"id":55}],[{"start":{"row":1,"column":78},"end":{"row":1,"column":79},"action":"remove","lines":["t"],"id":56}],[{"start":{"row":1,"column":77},"end":{"row":1,"column":78},"action":"remove","lines":["n"],"id":57}],[{"start":{"row":1,"column":76},"end":{"row":1,"column":77},"action":"remove","lines":["e"],"id":58}],[{"start":{"row":1,"column":75},"end":{"row":1,"column":76},"action":"remove","lines":["m"],"id":59}],[{"start":{"row":1,"column":74},"end":{"row":1,"column":75},"action":"remove","lines":["h"],"id":60}],[{"start":{"row":1,"column":73},"end":{"row":1,"column":74},"action":"remove","lines":["c"],"id":61}],[{"start":{"row":1,"column":72},"end":{"row":1,"column":73},"action":"remove","lines":["a"],"id":62}],[{"start":{"row":1,"column":71},"end":{"row":1,"column":72},"action":"remove","lines":["t"],"id":63}],[{"start":{"row":1,"column":70},"end":{"row":1,"column":71},"action":"remove","lines":["t"],"id":64}],[{"start":{"row":1,"column":69},"end":{"row":1,"column":70},"action":"remove","lines":["a"],"id":65}],[{"start":{"row":1,"column":68},"end":{"row":1,"column":69},"action":"remove","lines":["$"],"id":66}],[{"start":{"row":1,"column":67},"end":{"row":1,"column":68},"action":"remove","lines":[" "],"id":67}],[{"start":{"row":1,"column":66},"end":{"row":1,"column":67},"action":"remove","lines":[","],"id":68}],[{"start":{"row":3,"column":27},"end":{"row":3,"column":28},"action":"remove","lines":["o"],"id":69}],[{"start":{"row":3,"column":26},"end":{"row":3,"column":27},"action":"remove","lines":["t"],"id":70}],[{"start":{"row":3,"column":26},"end":{"row":3,"column":27},"action":"insert","lines":["d"],"id":71}],[{"start":{"row":3,"column":27},"end":{"row":3,"column":28},"action":"insert","lines":["e"],"id":72}],[{"start":{"row":3,"column":28},"end":{"row":3,"column":29},"action":"insert","lines":["t"],"id":73}],[{"start":{"row":3,"column":28},"end":{"row":3,"column":29},"action":"remove","lines":["t"],"id":74}],[{"start":{"row":3,"column":28},"end":{"row":3,"column":29},"action":"insert","lines":["s"],"id":75}],[{"start":{"row":3,"column":29},"end":{"row":3,"column":30},"action":"insert","lines":["t"],"id":76}],[{"start":{"row":3,"column":30},"end":{"row":3,"column":31},"action":"insert","lines":["i"],"id":77}],[{"start":{"row":3,"column":31},"end":{"row":3,"column":32},"action":"insert","lines":["u"],"id":78}],[{"start":{"row":3,"column":32},"end":{"row":3,"column":33},"action":"insert","lines":["n"],"id":79}],[{"start":{"row":3,"column":33},"end":{"row":3,"column":34},"action":"insert","lines":["o"],"id":80}],[{"start":{"row":3,"column":33},"end":{"row":3,"column":34},"action":"remove","lines":["o"],"id":81}],[{"start":{"row":3,"column":32},"end":{"row":3,"column":33},"action":"remove","lines":["n"],"id":82}],[{"start":{"row":3,"column":31},"end":{"row":3,"column":32},"action":"remove","lines":["u"],"id":83}],[{"start":{"row":3,"column":31},"end":{"row":3,"column":32},"action":"insert","lines":["n"],"id":84}],[{"start":{"row":3,"column":32},"end":{"row":3,"column":33},"action":"insert","lines":["o"],"id":85}],[{"start":{"row":3,"column":48},"end":{"row":3,"column":49},"action":"remove","lines":["t"],"id":86}],[{"start":{"row":3,"column":47},"end":{"row":3,"column":48},"action":"remove","lines":["c"],"id":87}],[{"start":{"row":3,"column":46},"end":{"row":3,"column":47},"action":"remove","lines":["e"],"id":88}],[{"start":{"row":3,"column":45},"end":{"row":3,"column":46},"action":"remove","lines":["j"],"id":89}],[{"start":{"row":3,"column":44},"end":{"row":3,"column":45},"action":"remove","lines":["b"],"id":90}],[{"start":{"row":3,"column":43},"end":{"row":3,"column":44},"action":"remove","lines":["u"],"id":91}],[{"start":{"row":3,"column":42},"end":{"row":3,"column":43},"action":"remove","lines":["s"],"id":92}],[{"start":{"row":3,"column":42},"end":{"row":3,"column":43},"action":"insert","lines":["a"],"id":93}],[{"start":{"row":3,"column":43},"end":{"row":3,"column":44},"action":"insert","lines":["s"],"id":94}],[{"start":{"row":3,"column":44},"end":{"row":3,"column":45},"action":"insert","lines":["u"],"id":95}],[{"start":{"row":3,"column":45},"end":{"row":3,"column":46},"action":"insert","lines":["n"],"id":96}],[{"start":{"row":3,"column":46},"end":{"row":3,"column":47},"action":"insert","lines":["t"],"id":97}],[{"start":{"row":3,"column":47},"end":{"row":3,"column":48},"action":"insert","lines":["o"],"id":98}],[{"start":{"row":3,"column":61},"end":{"row":3,"column":62},"action":"remove","lines":["g"],"id":99}],[{"start":{"row":3,"column":60},"end":{"row":3,"column":61},"action":"remove","lines":["a"],"id":100}],[{"start":{"row":3,"column":59},"end":{"row":3,"column":60},"action":"remove","lines":["s"],"id":101}],[{"start":{"row":3,"column":58},"end":{"row":3,"column":59},"action":"remove","lines":["s"],"id":102}],[{"start":{"row":3,"column":58},"end":{"row":3,"column":59},"action":"insert","lines":["n"],"id":103}],[{"start":{"row":3,"column":59},"end":{"row":3,"column":60},"action":"insert","lines":["s"],"id":104}],[{"start":{"row":3,"column":60},"end":{"row":3,"column":61},"action":"insert","lines":["a"],"id":105}],[{"start":{"row":3,"column":61},"end":{"row":3,"column":62},"action":"insert","lines":["j"],"id":106}],[{"start":{"row":3,"column":74},"end":{"row":3,"column":75},"action":"remove","lines":["m"],"id":107}],[{"start":{"row":3,"column":73},"end":{"row":3,"column":74},"action":"remove","lines":["o"],"id":108}],[{"start":{"row":3,"column":72},"end":{"row":3,"column":73},"action":"remove","lines":["r"],"id":109}],[{"start":{"row":3,"column":71},"end":{"row":3,"column":72},"action":"remove","lines":["f"],"id":110}],[{"start":{"row":3,"column":71},"end":{"row":3,"column":72},"action":"insert","lines":["o"],"id":111}],[{"start":{"row":3,"column":72},"end":{"row":3,"column":73},"action":"insert","lines":["r"],"id":112}],[{"start":{"row":3,"column":73},"end":{"row":3,"column":74},"action":"insert","lines":["i"],"id":113}],[{"start":{"row":3,"column":74},"end":{"row":3,"column":75},"action":"insert","lines":["g"],"id":114}],[{"start":{"row":3,"column":75},"end":{"row":3,"column":76},"action":"insert","lines":["e"],"id":115}],[{"start":{"row":3,"column":76},"end":{"row":3,"column":77},"action":"insert","lines":["n"],"id":116}],[{"start":{"row":3,"column":95},"end":{"row":3,"column":111},"action":"remove","lines":[", $attachment=[]"],"id":117}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":118}],[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""],"id":119}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["<"],"id":120}],[{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["?"],"id":121}],[{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["p"],"id":122}],[{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["h"],"id":123}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":["p"],"id":124}],[{"start":{"row":90,"column":1},"end":{"row":91,"column":0},"action":"insert","lines":["",""],"id":125}],[{"start":{"row":91,"column":0},"end":{"row":92,"column":0},"action":"insert","lines":["",""],"id":126}],[{"start":{"row":92,"column":0},"end":{"row":92,"column":1},"action":"insert","lines":["?"],"id":127}],[{"start":{"row":92,"column":1},"end":{"row":92,"column":2},"action":"insert","lines":[">"],"id":128}],[{"start":{"row":7,"column":52},"end":{"row":7,"column":53},"action":"remove","lines":["P"],"id":129}],[{"start":{"row":7,"column":51},"end":{"row":7,"column":52},"action":"remove","lines":["H"],"id":130}],[{"start":{"row":7,"column":50},"end":{"row":7,"column":51},"action":"remove","lines":["P"],"id":131}],[{"start":{"row":7,"column":49},"end":{"row":7,"column":50},"action":"remove","lines":["o"],"id":132}],[{"start":{"row":7,"column":48},"end":{"row":7,"column":49},"action":"remove","lines":["e"],"id":133}],[{"start":{"row":7,"column":47},"end":{"row":7,"column":48},"action":"remove","lines":["r"],"id":134}],[{"start":{"row":7,"column":46},"end":{"row":7,"column":47},"action":"remove","lines":["r"],"id":135}],[{"start":{"row":7,"column":45},"end":{"row":7,"column":46},"action":"remove","lines":["o"],"id":136}],[{"start":{"row":7,"column":44},"end":{"row":7,"column":45},"action":"remove","lines":["C"],"id":137}],[{"start":{"row":7,"column":44},"end":{"row":7,"column":45},"action":"insert","lines":["c"],"id":138}],[{"start":{"row":7,"column":45},"end":{"row":7,"column":46},"action":"insert","lines":["o"],"id":139}],[{"start":{"row":7,"column":46},"end":{"row":7,"column":47},"action":"insert","lines":["r"],"id":140}],[{"start":{"row":7,"column":47},"end":{"row":7,"column":48},"action":"insert","lines":["r"],"id":141}],[{"start":{"row":7,"column":48},"end":{"row":7,"column":49},"action":"insert","lines":["e"],"id":142}],[{"start":{"row":7,"column":49},"end":{"row":7,"column":50},"action":"insert","lines":["o"],"id":143}],[{"start":{"row":8,"column":37},"end":{"row":8,"column":109},"action":"insert","lines":["750166320318-drg7l14mcm8qtv254jhb84sbqik6jm29.apps.googleusercontent.com"],"id":144}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":8,"column":109},"end":{"row":8,"column":109},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1451820153081}